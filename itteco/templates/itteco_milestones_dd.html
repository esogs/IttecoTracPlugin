<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xmlns:py="http://genshi.edgewall.org/" py:strip="">

    <div py:def="render_milestones(items, level, maxlevel, hide_completed)" py:strip="">
        <py:if test="items and (maxlevel==-1 or (maxlevel-level)!=0)">
            <py:for each="item in items" py:if="not (item.completed and hide_completed)">
                <div style="padding-left:${(level+1)*10}px" class="${item.completed and 'completed_milestone' or ''}"><em>${item.name}</em>(${item.level['label']})</div>
                ${render_milestones(item.kids, level +1, maxlevel, hide_completed)}
            </py:for>
        </py:if>
    </div>

    <div py:def="render_milestone_selection(parent, field_name, maxlevel, hide_completed)" py:strip="">
        <div id="milestones_tree">
            <div class="custom_drop_down" onclick="toggleDD(this);">
                ${parent or ''}
            </div>
            <div class="custom_drop_down_box">
                <div empty="1" style="min-height:1.3em;"><em></em></div>
                ${render_milestones(structured_milestones,0, maxlevel, hide_completed)}
            </div>
            <input type="hidden" name="${field_name}" value="${parent}"/>
            <input type="hidden" name="old_${field_name}" value="${parent}"/>
        </div>
    </div>
    ${render_milestone_selection(milestone_name,field_name, max_level or -1, hide_completed)}
</html>

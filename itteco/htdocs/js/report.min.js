function log(){if(typeof(console)!="undefined"&&console.log){console.log(arguments)}}(function(a){a.fn.extend({executableGroup:function(f){if(typeof f=="string"){var e=Array.prototype.slice.call(arguments,1);var v=a.data(document,"executableGroup")[f].apply(this,e);if(v!=undefined){return v}return this}var w='<div id="dragHelper"><div>Dragging <span class="quantity">0</span> tickets.</div></div>';var p={selectedTickets:[],groups:{}};var n={drop_box_items_selector:"#dropbox .content .report-result",all_tickets_selector:".listing tbody tr",rpcurl:"/login/xmlrpc",draggable_options:{helper:function(x){return a(w).get()},opacity:0.8,},groupItemsContainer:function(x){return a(x).next()},selectionCallback:function(){},debug:false};var f=a.extend(n,f);var c=a.rpc(f.rpcurl,"xml",function(x){if(!x||!x.system){alert("Could not get the rpc object ..");return}j("rpc initialized")});function j(){if(f.debug){console.log.apply(console,arguments)}}j("created instance of excutable group for",this);function b(x){a.each(x,function(y,z){a(':chekbox:checked[value="'+z+'"]').attr("disabled","disabled")})}function s(x){a.each(x,function(z,A){var y=a(':chekbox:[value="'+A+'"]');y.removeAttr("disabled").attr("checked",false);o(y,A);t(a('td.ticket[ticket="'+A+'"]'),A)})}function d(x,A){j("executeAjaxAction",x,A);var z=p.groups[A];var y=z.element;p.selectedTickets=[];f.selectionCallback(p.selectedTickets.length>0,p.selectedTickets);c.ticketconfig.apply_preset(function(I){var B=I.result.tickets;if(B){var D=[];a.each(B,function(){D.push(' td.ticket[ticket="'+this+'"]')});var G=a(D.join(","),a(".listing tbody")).parent();j("removing rows",G);var C=f.groupItemsContainer(z.ticketsElement);if(C.length>0){G.appendTo(a("tbody",C))}else{G.remove();var F=a(".numrows",y);var E=F.text().match(/\d+/);var H=0;if(E){H=parseInt(E[0],10)}F.text(q(H+G.length))}k();s(B)}},x,z.preset)}function m(){a("#dropbox .control-panel a").unbind("click").click(function(){a("#dropbox .control-panel>*").add("#dropbox .content").toggle()})}function i(){j("selectedTickets are",p.selectedTickets);return p.selectedTickets}function g(x){j("dropped tickets",p.selectedTickets,x,i());b(p.selectedTickets);d(p.selectedTickets,x)}function u(x){j("decorateDropBoxItems",x);var y=a(x);y.each(function(A){var z=a(this);var B=a(".exec-group-name",z).text();p.groups[B]={name:B,preset:z.attr("preset"),element:z};z.attr("idx","group_"+A);z.droppable({accept:".ticket",activeClass:"droppable-active",hoverClass:"droppable-hover",drop:function(D,C){g(B)}})})}function l(y){y.addClass("executableGroup");var A=a(".exec-group-name",y).text();var z=p.groups[A];j("setting up group ",A,z);if(z){p.groups[A].ticketsElement=y;var x=f.groupItemsContainer(y);a("thead tr",x).prepend('<th class="t-right t-s t-check"/>');h(x)}}function t(y,x){y.draggable(a.extend(f.draggable_options,{start:function(A,z){if(p.selectedTickets.length==0){p.selectedTickets.push(x)}a(".quantity",z.helper).text(p.selectedTickets.length)},cancel:function(A,z){if(p.selectedTickets.length==1&&a(':chekbox:checked[value="'+x+'"]').length==0){j("canceling selection");p.selectedTickets=[]}}}));y.parent().removeClass("selected")}function o(x,y){x.click(function(){if(a(this).is(":checked")){p.selectedTickets.push(y)}else{p.selectedTickets=a.grep(p.selectedTickets,function(A,z){j("grep",A,y);return A!=y})}j("selectedTickets",y,p.selectedTickets);a(this).parent().parent().toggleClass("selected");f.selectionCallback(p.selectedTickets.length>0,p.selectedTickets)})}function h(y){var x=a("td.ticket",y);x.css("cursor","move");a("a",x).addClass("ticket-pointer");x.each(function(A){var z=a(this),B;var C=a("a",z).text().substring(1);z.attr("ticket",C);z.before(a("<td/>").append(B=a('<input type="checkbox" value="'+C+'"/>')));o(B,C);t(z,C)})}function q(y){var x="No matches";if(y>0){if(y==1){x="1 match"}else{x=""+y+" matches"}}return x}function k(){a.each(p.groups,function(y,z){if(z.ticketsElement){var x=q(a("td.ticket",f.groupItemsContainer(z.ticketsElement)).length);a(".numrows",z.ticketsElement).text(x);a(".numrows",z.element).text(x)}})}m();u(f.drop_box_items_selector);var r={assign:function(x){g(x)},};a.data(document,"executableGroup",r);return this.each(function(){var x=f;j("enabling executable groups for",this,f);l(a(this))})},outerHTML:function(){return a("<div>").append(this.eq(0).clone()).html()}})})(jQuery);
function log(){if(typeof(console)!="undefined"&&console.log){console.log.apply(console,arguments)}}function showPopup(c,b){function a(){$.fn.colorbox.close();return false}window.popup_context={cancel:a,setup:function(d){},done:function(d){log("popup reports that action was done",d);return a()}};$.fn.colorbox({href:"./../popup/"+b+"/"+c,open:true,title:"Edit Ticket"})}function showQuickEditor(a){showPopup(a,"tickets")}function showCommentEditor(a){showPopup(a,"comment")}function showFullEditor(a){document.location="./../ticket/"+a}(function(a){a.fn.extend({executableGroup:function(q){var f='<div id="dragHelper"><div>Dragging <span class="quantity">0</span> tickets.</div></div>';var h={drop_box_items_selector:"#dropbox .content .report-result",all_tickets_selector:".listing tbody td.ticket",draggable_options:{helper:function(r){return a(f).get()},opacity:0.8,start:function(s,r){a(".quantity",r.helper).text(a(":checked").length||1)}},groupItemsContainer:function(r){return a(r).next()}};var q=a.extend(h,q);function j(){if(q.debug&&typeof console!="undefined"){console.log.apply("",arguments)}}function o(){a("body").append('<div id="inline-menu"><div id="inline-menu-body"></div></div>');var s=a("#inline-menu");var v=a("#inline-menu-body");function r(w){j("element",w,a(w));offset=a(w).offset();s.css("left",offset.left);s.css("top",offset.top);menuItems=u(w);if(menuItems){v.html("<div>"+a(w).outerHTML()+"</div>"+menuItems);s.show()}}function u(w){var x=a(w).text().substr(1);if(a(w).hasClass("ticket-pointer")){menu="<ul>";menu+='<li class="inline-menu-item-ticket-quick-editor"><a href="#quickeditor" onclick="showQuickEditor(\''+x+"')\">Quick Editor</a></li>";menu+='<li class="inline-menu-item-ticket-comment"><a href="#comment" onclick="showCommentEditor(\''+x+"')\">Comment</a></li>";menu+='<li class="inline-menu-item-ticket-full-editor"><a href="#fulleditor" onclick="showFullEditor(\''+x+"')\">Full Editor</a></li>";menu+="</ul>"}return menu}function t(w){a(w).mouseover(function(){r(this)})}this.attachTo=t;t(a(".ticket-pointer"));a(s).hover(function(w){},function(w){a(s).hide()})}var p=function(r){a(":checked",r).attr("disabled","disabled")};var g=function(r){a(":checked",r).removeAttr("disabled").attr("checked",false);a("td.ticket",r).draggable(q.draggable_options)};var m=function(s){var r=s.text();s.children().each(function(){r=r.replace(a(this).text(),"")});return r.replace(/\n\s*/,"")};var n=function(r,t){var s=a.map(r,function(v,u){return a("a",v).text().substring(1)});a.getJSON(document.location.pathname,{action:"execute",tickets:s.join(","),presets:t.attr("preset")},function(z){if(z&&z.tickets){var v=[];a.each(z.tickets,function(){v.push(' td.ticket[ticket="'+this+'"]')});var y=a(v.join(","),".listing tbody").parent().remove();var u=q.groupItemsContainer('.executableGroup[idx="'+t.attr("idx")+'"]');if(u.length>0){a("tbody",u).append(y)}else{var x=a(".numrows",t);var w=x.text().match(/\d+/);var A=0;if(w){A=parseInt(w[0],10)}x.text(i(A+y.length))}b();g(y)}})};var c=function(t,s){var r=a(q.all_tickets_selector+":has(:checked)");if(r.length==0){r=s.draggable}p(r);n(r,a(this))};var e=function(){a("#dropbox .control-panel a").unbind("click").click(function(){a("#dropbox .control-panel>*").add("#dropbox .content").toggle()})};var d=function(r){var s=a(r);s.each(function(u){var t=a(this);t.attr("pattern",m(t));t.attr("idx","group_"+u);if(a(".move-here",t).length==0){t.droppable({accept:".ticket",activeClass:"droppable-active",hoverClass:"droppable-hover",drop:c});t.prepend('<div class="move-here">&#x00BB;</div>');a(".move-here",t).click(function(){var v=a(".listing tbody td.ticket:has(:checked)");if(v.length>0){p(v);n(v,a(this).parent())}})}})};var l=function(t){var s=a(t);s.addClass("executableGroup");var r=a(q.drop_box_items_selector+'[pattern="'+m(t)+'"]');if(r.length==1){s.attr("idx",r.attr("idx"))}};var k=function(t){var r=a("td.ticket",t);r.css("cursor","move").prepend('<input type="checkbox"/>');var s=new o();s.attachTo(a("a",r).addClass("ticket-pointer"));r.each(function(v){var u=a(this);var w=a("a",u).text().substring(1);u.attr("ticket",w)});r.draggable(q.draggable_options)};var i=function(s){var r="(No matches)";if(s>0){if(s==1){r="(1 match)"}else{r="("+s+" matches)"}}return r};var b=function(){var r=a(q.drop_box_items_selector);a(".executableGroup").each(function(t){var u=a(this);var s=i(a("td.ticket",q.groupItemsContainer(u)).length);a(".numrows",u).text(s);a(".numrows",r.filter('[idx="'+u.attr("idx")+'"]')).text(s)})};e();d(q.drop_box_items_selector);return this.each(function(){var r=q;l(a(this));k(r.groupItemsContainer(this))})},outerHTML:function(){return a("<div>").append(this.eq(0).clone()).html()}})})(jQuery);$(document).ready(function(){$("#content h2.report-result").executableGroup()});
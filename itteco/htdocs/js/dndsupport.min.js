dragable_options={helper:"clone",handle:"dt",opacity:0.8,start:function(b,a){a.helper.css("width",this.offsetWidth+"px")}};searchViaJson=function(a,b){$.getJSON(a,b,function(c){$.each(c.items,function(d,e){var f=e.href.substr(e.href.lastIndexOf("/")+1);var g=(("x"+document.location.pathname)!=("x"+e.href)&&$("#links_"+e.type+'_container > input[value="'+f+'"]').length==0);$("#results").append($("<div/>").attr({item_type:e.type,idx:e.idx,"class":g?"draggable":"draggable_inactive"}).append($("<dl/>").append($("<dt/>").append($("<a/>").attr({href:e.href,"class":"searchable",idx:e.idx,target:"_blank"}).append(e.title))).append($('<dd class="description"/>').append(e.excerpt)).append($('<dd class="author"/>').append(e.author?$('<span class="author"/>').text("By "+e.author):"").append($('<span class="date"/>').text(e.date)))))});$(".draggable").draggable(dragable_options)})};removeLinkFunction=function(b){var c=$(b);var a=c.attr("item_type");$("#links_"+a+"_container").children('input[value="'+c.attr("linkid")+'"]').remove();$('.draggable_inactive:has(a[href="'+c.siblings("a:first").attr("href")+'"])',$("#results")).removeClass("draggable_inactive").addClass("draggable").draggable(dragable_options).draggable("enable");c.parent().remove();return false};dropFunction=function(g,f){var h=$(f.draggable).attr("idx");var i=$(f.draggable).attr("item_type");var d=$(".searchable",$(f.draggable));var a=d.attr("href").substr(d.attr("href").lastIndexOf("/")+1);$("a[href!='#'][target!='_blank']",$("#traceability")).attr("target","_blank");var e=$('<a href="#" class="action_button" onclick="removeLinkFunction(this); return false;">Remove</a>').attr("linkid",a).attr("item_type",i);var c=false;var b=$("<li/>").append(d.clone().addClass("new_link")).append("&nbsp;").append(e);$("ul > li > a[href!='#']",this).each(function(k){var j=$(this).attr("idx");if(j>h||(j==h&&this.innerHTML>d.text())){$(this).parent().before(b);c=true;return false}});if(!c){$(this).children("ul").append(b)}$(f.draggable).removeClass("draggable").addClass("draggable_inactive").draggable("disable");$("#links_"+i+"_container").append($('<input type="hidden"/>').attr({name:"links_"+i,value:a}))};performSearch=function(b,a){$("#results").empty();searchViaJson(a,$(b).serialize());return false};$(document).ready(function(){$(".draggable").draggable(dragable_options);$(".outblock").droppable({accept:".draggable",activeClass:"droppable-active",hoverClass:"droppable-hover",drop:dropFunction})});